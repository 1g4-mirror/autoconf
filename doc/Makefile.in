# Makefile for Autoconf.
# Copyright (C) 1992, 1993, 1994 Free Software Foundation, Inc.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

#### Start of system configuration section. ####

srcdir = @srcdir@
VPATH = @srcdir@

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
MAKEINFO = makeinfo
TEXI2DVI = texi2dvi
M4 = @M4@

PROGS = autoconf autoheader autoreconf @PROGS@
# Path of the perl interpreter.
PERL = @PERL@

prefix = /usr/local
exec_prefix = $(prefix)

# Directory in which to install scripts.
bindir = $(exec_prefix)/bin

# Directory in which to install library files.
datadir = $(prefix)/lib
acdatadir = $(datadir)/autoconf

# Directory in which to install documentation info files.
infodir = $(prefix)/info

#### End of system configuration section. ####

SHELL = /bin/sh

# Files that can be generated, but should be in the distribution.
DISTSTUFF = info Makefile
# Files to distribute.
DISTROOT = COPYING Makefile.in README \
	config.guess config.sub configure configure.in \
	install.sh move-if-change
DISTAUTOCONF = autoconf/ChangeLog \
	autoconf/INSTALL autoconf/Makefile.in autoconf/NEWS \
	autoconf/README autoconf/acconfig.h autoconf/acfunctions \
	autoconf/acgeneral.m4 autoconf/acheaders autoconf/acidentifiers \
	autoconf/acmakevars autoconf/acprograms autoconf/acspecific.m4 \
	autoconf/autoconf.sh autoconf/autoconf.texi \
	autoconf/autoheader.sh autoconf/autoscan.pl autoconf/autoreconf.sh \
	autoconf/configure autoconf/configure.in autoconf/mkinstalldirs \
	autoconf/autoconf.info*

DISTETC = etc/Makefile.in \
	etc/cfg-paper.texi etc/configure.in etc/configure.man \
	etc/configure.texi etc/standards.texi etc/make-stds.texi \
	etc/cfg-paper.info* etc/configure.info* etc/standards.info*
DISTTEXINFO = texinfo/tex3patch texinfo/texinfo.tex

# Where to find texinfo.tex to format documentation with TeX.
TEXIDIR = $(srcdir)/../texinfo

editsh = sed -e 's,@''datadir''@,$(acdatadir),g' -e 's,@''M4''@,$(M4),g'
editpl = sed -e 's,@''datadir''@,$(acdatadir),g' -e 's,@''PERL''@,$(PERL),g'

all: ${PROGS}

autoconf: autoconf.sh
	rm -f $@ $@.tmp
	$(editsh) $(srcdir)/autoconf.sh > $@.tmp && mv $@.tmp $@ && chmod +x $@

autoheader: autoheader.sh
	rm -f $@ $@.tmp
	$(editsh) $(srcdir)/autoheader.sh > $@.tmp && mv $@.tmp $@ && chmod +x $@

autoreconf: autoreconf.sh
	rm -f $@ $@.tmp
	$(editsh) $(srcdir)/autoreconf.sh > $@.tmp && mv $@.tmp $@ && chmod +x $@

autoscan: autoscan.pl
	rm -f $@ $@.tmp
	$(editpl) $(srcdir)/autoscan.pl > $@.tmp && mv $@.tmp $@ && chmod +x $@

info: autoconf.info

autoconf.info: autoconf.texi
	$(MAKEINFO) -I$(srcdir) $(srcdir)/autoconf.texi --output=$@

dvi: autoconf.dvi

autoconf.dvi: autoconf.texi
	TEXINPUTS=$(TEXIDIR):$$TEXINPUTS $(TEXI2DVI) $(srcdir)/autoconf.texi

check:
installcheck:

installdirs: mkinstalldirs $(bindir) $(infodir) $(acdatadir)
	$(SHELL) ${srcdir}/mkinstalldirs $(bindir) $(infodir) $(acdatadir)

# References to install-info have been removed until it's released.
install: acgeneral.m4 acspecific.m4 acconfig.h installdirs
	$(INSTALL_PROGRAM) autoconf $(bindir)/autoconf
	$(INSTALL_PROGRAM) autoheader $(bindir)/autoheader
	$(INSTALL_PROGRAM) autoreconf $(bindir)/autoreconf
	$(INSTALL_DATA) $(srcdir)/acgeneral.m4 $(acdatadir)/acgeneral.m4
	$(INSTALL_DATA) $(srcdir)/acspecific.m4 $(acdatadir)/acspecific.m4
	$(INSTALL_DATA) $(srcdir)/acconfig.h $(acdatadir)/acconfig.h
	-if test -f autoscan; then \
	$(INSTALL_PROGRAM) autoscan $(bindir)/autoscan; \
	$(INSTALL_DATA) $(srcdir)/acfunctions $(acdatadir)/acfunctions; \
	$(INSTALL_DATA) $(srcdir)/acheaders $(acdatadir)/acheaders; \
	$(INSTALL_DATA) $(srcdir)/acidentifiers $(acdatadir)/acidentifiers; \
	$(INSTALL_DATA) $(srcdir)/acprograms $(acdatadir)/acprograms; \
	$(INSTALL_DATA) $(srcdir)/acmakevars $(acdatadir)/acmakevars; \
	else :; fi

install-info: installdirs
	-if test -f autoconf.info; then d=.; else d=$(srcdir); fi; \
	cd $$d; for i in *.info*; do \
	$(INSTALL_DATA) $$i $(infodir)/$$i; \
	done

uninstall:
	rm -f $(bindir)/autoconf $(bindir)/autoheader $(bindir)/autoscan 
	rm -f $(bindir)/autoreconf
	rm -fr $(acdatadir)
	cd $(infodir); rm -f autoconf.info*

configure: configure.in acgeneral.m4 acspecific.m4
	cd $(srcdir); \
	rm -f $@ $@.tmp; \
	$(M4) acgeneral.m4 acspecific.m4 configure.in > $@.tmp && \
	mv $@.tmp $@ && \
	chmod +x $@
Makefile: Makefile.in config.status
	./config.status
config.status: configure
	./config.status --recheck

clean:
	rm -f autoconf autoheader autoscan autoreconf *.tmp
	rm -f *.aux *.cp *.cps *.dvi *.fn *.fns *.ky *.kys *.log
	rm -f *.pg *.pgs *.toc *.tp *.tps *.vr *.vrs *.ma *.mas

mostlyclean: clean

distclean: clean
	rm -f Makefile config.status

realclean: distclean
	rm -f TAGS *.info*

TAGS:
	etags ${srcdir}/*.m4 ${srcdir}/*.sh ${srcdir}/[a-z]*.in ${srcdir}/*.texi

diststuff: $(DISTSTUFF)

dist: diststuff
	cd ../etc; ${MAKE} info
	distname=`sed -e '/define(AC_ACVERSION,/!d' \
	-e 's/[^0-9.]*\([0-9.]*\).*/autoconf-\1/' -e q acgeneral.m4`; \
	cd ..; \
	chmod -R go+rX .; \
	rm -fr $$distname; \
	mkdir $$distname $$distname/autoconf $$distname/etc $$distname/texinfo; \
	for file in $(DISTROOT); do \
	  ln $$file $$distname \
	  || { echo copying $$file instead; cp -p $$file $$distname;}; \
	done; \
	for file in $(DISTAUTOCONF); do \
	  ln $$file $$distname/autoconf \
	  || { echo copying $$file instead; cp -p $$file $$distname/autoconf;}; \
	done; \
	for file in $(DISTETC); do \
	  ln $$file $$distname/etc \
	  || { echo copying $$file instead; cp -p $$file $$distname/etc;}; \
	done; \
	for file in $(DISTTEXINFO); do \
	  ln $$file $$distname/texinfo \
	  || { echo copying $$file instead; cp -p $$file $$distname/texinfo;}; \
	done; \
	tar -chz -f autoconf/$$distname.tar.gz $$distname; \
	rm -fr $$distname
